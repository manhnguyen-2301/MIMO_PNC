function y = qammod(x,M)
%========================================
% Written by Pham Van Bien
% The Le Quy Don Technical University    
% Created: 26/11/2009
% Last modified: 26/11/2009
%=======================================

k = log2(M);
numsymbol = length(x)/k;
b = reshape(x,numsymbol,k);
y = zeros(numsymbol,1);

%======= generate QAM constellation ======================
if M==2
  mapping = [-1 1];
elseif M==4
  mapping = [-1-j -1+j 1-j 1+j];
elseif M==8
  mapping = j*[-1-3*j -1-j -1+j -1+3*j 1-3*j 1-j 1+j 1+3*j];
elseif M==16
  mapping = [-3-3*j -3-j -3+j -3+3*j -1-3*j -1-j -1+j -1+3*j 1-3*j 1-j 1+j 1+3*j 3-3*j 3-j 3+j 3+3*j];
elseif M==32
  mapping = j*[-3-j*7 -3-j*5 -3-j*3 -3-j -3+j -3+3*j -3+5*j -3+7*j -1-j*7 -1-j*5 -1-j*3 -1-j -1+j -1+3*j -1+5*j -1+7*j 1-j*7 1-j*5 1-j*3 1-j 1+j 1+3*j 1+5*j 1+7*j 3-j*7 3-j*5 3-j*3 3-j 3+j 3+3*j 3+5*j 3+7*j];   
elseif M==64
  mapping = [-7-7*j -7-5*j -7-3*j -7-j -7+j -7+3*j -7+5*j -7+7*j -5-j*7 -5-j*5 -5-j*3 -5-j -5+j -5+3*j -5+5*j -5+7*j -3-j*7 -3-j*5 -3-j*3 -3-j -3+j -3+3*j -3+5*j -3+7*j -1-j*7 -1-j*5 -1-j*3 -1-j -1+j -1+3*j -1+5*j -1+7*j 1-j*7 1-j*5 1-j*3 1-j 1+j 1+3*j 1+5*j 1+7*j 3-j*7 3-j*5 3-j*3 3-j 3+j 3+3*j 3+5*j 3+7*j 5-j*7 5-j*5 5-j*3 5-j 5+j 5+3*j 5+5*j 5+7*j 7-j*7 7-j*5 7-j*3 7-j 7+j 7+3*j 7+5*j 7+7*j];
elseif M==128
  mapping = j*[-7-15*j -7-13*j -7-11*j -7-9*j -7-7*j -7-5*j -7-3*j -7-j -7+j -7+3*j -7+5*j -7+7*j -7+9*j -7+11*j -7+13*j -7+15*j -5-15*j -5-13*j -5-11*j -5-9*j -5-7*j -5-5*j -5-3*j -5-j -5+j -5+3*j -5+5*j -5+7*j -5+9*j -5+11*j -5+13*j -5+15*j -3-15*j -3-13*j -3-11*j -3-9*j -3-7*j -3-5*j -3-3*j -3-j -3+j -3+3*j -3+5*j -3+7*j -3+9*j -3+11*j -3+13*j -3+15*j -1-15*j -1-13*j -1-11*j -1-9*j -1-7*j -1-5*j -1-3*j -1-j -1+j -1+3*j -1+5*j -1+7*j -1+9*j -1+11*j -1+13*j -1+15*j 7-15*j 7-13*j 7-11*j 7-9*j 7-7*j 7-5*j 7-3*j 7-j 7+j 7+3*j 7+5*j 7+7*j 7+9*j 7+11*j 7+13*j 7+15*j 5-15*j 5-13*j 5-11*j 5-9*j 5-7*j 5-5*j 5-3*j 5-j 5+j 5+3*j 5+5*j 5+7*j 5+9*j 5+11*j 5+13*j 5+15*j 3-15*j 3-13*j 3-11*j 3-9*j 3-7*j 3-5*j 3-3*j 3-j 3+j 3+3*j 3+5*j 3+7*j 3+9*j 3+11*j 3+13*j 3+15*j 1-15*j 1-13*j 1-11*j 1-9*j 1-7*j 1-5*j 1-3*j 1-j 1+j 1+3*j 1+5*j 1+7*j 1+9*j 1+11*j 1+13*j 1+15*j];   
elseif M==256
  mapping = [-15-15*j -15-13*j -15-11*j -15-9*j -15-7*j -15-5*j -15-3*j -15-j -15+j -15+3*j -15+5*j -15+7*j -15+9*j -15+11*j -15+13*j -15+15*j -13-15*j -13-13*j -13-11*j -13-9*j -13-7*j -13-5*j -13-3*j -13-j -13+j -13+3*j -13+5*j -13+7*j -13+9*j -13+11*j -13+13*j -13+15*j -11-15*j -11-13*j -11-11*j -11-9*j -11-7*j -11-5*j -11-3*j -11-j -11+j -11+3*j -11+5*j -11+7*j -11+9*j -11+11*j -11+13*j -11+15*j -9-15*j -9-13*j -9-11*j -9-9*j -9-7*j -9-5*j -9-3*j -9-j -9+j -9+3*j -9+5*j -9+7*j -9+9*j -9+11*j -9+13*j -9+15*j -7-15*j -7-13*j -7-11*j -7-9*j -7-7*j -7-5*j -7-3*j -7-j -7+j -7+3*j -7+5*j -7+7*j -7+9*j -7+11*j -7+13*j -7+15*j -5-15*j -5-13*j -5-11*j -5-9*j -5-7*j -5-5*j -5-3*j -5-j -5+j -5+3*j -5+5*j -5+7*j -5+9*j -5+11*j -5+13*j -5+15*j -3-15*j -3-13*j -3-11*j -3-9*j -3-7*j -3-5*j -3-3*j -3-j -3+j -3+3*j -3+5*j -3+7*j -3+9*j -3+11*j -3+13*j -3+15*j -1-15*j -1-13*j -1-11*j -1-9*j -1-7*j -1-5*j -1-3*j -1-j -1+j -1+3*j -1+5*j -1+7*j -1+9*j -1+11*j -1+13*j -1+15*j 15-15*j 15-13*j 15-11*j 15-9*j 15-7*j 15-5*j 15-3*j 15-j 15+j 15+3*j 15+5*j 15+7*j 15+9*j 15+11*j 15+13*j 15+15*j 13-15*j 13-13*j 13-11*j 13-9*j 13-7*j 13-5*j 13-3*j 13-j 13+j 13+3*j 13+5*j 13+7*j 13+9*j 13+11*j 13+13*j 13+15*j 11-15*j 11-13*j 11-11*j 11-9*j 11-7*j 11-5*j 11-3*j 11-j 11+j 11+3*j 11+5*j 11+7*j 11+9*j 11+11*j 11+13*j 11+15*j 9-15*j 9-13*j 9-11*j 9-9*j 9-7*j 9-5*j 9-3*j 9-j 9+j 9+3*j 9+5*j 9+7*j 9+9*j 9+11*j 9+13*j 9+15*j 7-15*j 7-13*j 7-11*j 7-9*j 7-7*j 7-5*j 7-3*j 7-j 7+j 7+3*j 7+5*j 7+7*j 7+9*j 7+11*j 7+13*j 7+15*j 5-15*j 5-13*j 5-11*j 5-9*j 5-7*j 5-5*j 5-3*j 5-j 5+j 5+3*j 5+5*j 5+7*j 5+9*j 5+11*j 5+13*j 5+15*j 3-15*j 3-13*j 3-11*j 3-9*j 3-7*j 3-5*j 3-3*j 3-j 3+j 3+3*j 3+5*j 3+7*j 3+9*j 3+11*j 3+13*j 3+15*j 1-15*j 1-13*j 1-11*j 1-9*j 1-7*j 1-5*j 1-3*j 1-j 1+j 1+3*j 1+5*j 1+7*j 1+9*j 1+11*j 1+13*j 1+15*j];
end
%=========================================================

% Modulate input data x to QAM complex symbols 

for t = 1:numsymbol
    y(t,1)=mapping(1,bi2de(b(t,:),'left-msb')+1);
end

%====================================

